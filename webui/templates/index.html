<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>PricePilot Pro - –£–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ Drivee</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/assets/css/style.css" />
  </head>
  <body>
    <div class="app-container" id="app-container">
      <div class="map-area">
        <div class="header">
          <button id="debug-toggle-button" title="Debug menu"><i class="fas fa-bug"></i></button>
          <div style="display: flex; gap: 10px">
            <button onclick="toggleTheme()" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
              <i class="fas fa-sun" id="theme-icon"></i>
            </button>
            <button onclick="exitOrder()" class="exit-button" title="–í—ã–π—Ç–∏ –∏–∑ –∑–∞–∫–∞–∑–∞">
              <i class="fas fa-arrow-right"></i>
            </button>
          </div>
        </div>
        <div class="location-input-container">
          <div class="location-input-group">
            <div class="location-field">
              <i class="fas fa-search location-icon" title="–û—Ç–∫—É–¥–∞ (–∏—â–µ–º –∫–ª–∏–µ–Ω—Ç–∞)" onclick="showFromLocationModal()"></i>
              <input
                type="text"
                id="location-from"
                class="location-input"
                placeholder="–û—Ç–∫—É–¥–∞ –∑–∞–±–∏—Ä–∞–µ–º –∫–ª–∏–µ–Ω—Ç–∞?"
                value="–£–ª–∏—Ü–∞ –í–æ—Ä–æ–Ω–µ—á–∞ –í.–ò., 30+5"
                readonly
                disabled
              />
            </div>
            <div class="pickup-time" id="pickup-time">
              <i class="fas fa-clock"></i>
              <span id="pickup-time-text">~2 –º–∏–Ω –¥–æ –∫–ª–∏–µ–Ω—Ç–∞</span>
            </div>
            <div class="location-divider"></div>
            <div class="location-field">
              <i class="fas fa-map-marker-alt location-icon" title="–ö—É–¥–∞ (—Ç–æ—á–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è)" onclick="showToLocationModal()"></i>
              <input
                type="text"
                id="location-to"
                class="location-input"
                placeholder="–ö—É–¥–∞ –≤–µ–∑—ë–º?"
                value="—É–ª. –Ø—Ö–æ–Ω—Ç–æ–≤–∞—è, 1"
                readonly
                disabled
              />
            </div>
            <div class="pickup-time" id="trip-duration">
              <i class="fas fa-route"></i>
              <span id="trip-duration-text">~25 –º–∏–Ω –≤ –ø—É—Ç–∏ ‚Ä¢ 12.0 –∫–º</span>
            </div>
          </div>
        </div>
      </div>

      <div class="debug-overlay" id="debug-overlay"></div>
      <aside class="debug-panel" id="debug-panel">
        <div class="debug-header">
          <h2>Dev Debugger</h2>
          <button class="debug-close" onclick="toggleDebugPanel(false)">&times;</button>
        </div>
        <section class="debug-section">
          <h3>Raw JSON injector</h3>
          <div id="debug-json-container" class="debug-json-container">
            <textarea id="debug-json-input" spellcheck="false" placeholder='{"price_start_local":210,"distance_in_meters":4200}'></textarea>
            <div class="debug-json-actions">
              <button class="debug-button apply" onclick="applyJsonOverride()">Apply JSON</button>
              <button class="debug-button clear" onclick="clearJsonEditor()">Clear</button>
            </div>
            <div id="debug-json-status" class="debug-status"></div>
          </div>
        </section>
        <section class="debug-section">
          <h3>Auth</h3>
          <button class="debug-button" onclick="refreshToken()">Refresh JWT</button>
          <div id="debug-token-status" class="debug-status"></div>
        </section>
      </aside>

      <div class="bottom-sheet" id="bottom-sheet">
        <div class="loading-overlay" id="loading-overlay">
          <div class="loading-spinner">
            <i class="fas fa-circle-notch fa-spin"></i>
            <p>–ü–æ–∏—Å–∫ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã...</p>
          </div>
        </div>
        
        <div class="handle-bar"></div>

        <div class="order-info">
          <div class="client-avatar">–ò–õ</div>
          <div class="client-details">
            <strong
              >–ò–≤–∞–Ω –õ—É–Ω–∏–Ω
              <i
                class="fas fa-check-circle"
                style="color: var(--drivee-green); font-size: 14px; margin-left: 5px"
              ></i
            ></strong>
            <span
              ><i class="fas fa-star" style="color: var(--warning-color); margin-right: 3px"></i
              >4.9 –†–µ–π—Ç–∏–Ω–≥ | 12.0 –∫–º | 25 –º–∏–Ω</span
            >
          </div>
        </div>

        <div class="pricepilot-panel">
          <div class="button-group">
            <button class="accept-button" id="accept-start-price-button" onclick="acceptCurrentPrice()">
              –ü—Ä–∏–Ω—è—Ç—å –∑–∞ 180‚ÇΩ
            </button>
            <button class="analysis-button" onclick="showAnalysis()">
              <i class="fas fa-chart-line"></i> –ê–Ω–∞–ª–∏–∑
            </button>
          </div>

          <div class="bid-section">
            <h4>
              <span>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Ü–µ–Ω–∞:</span>
              <span class="optimal-price-text" id="optimal-price-text" onclick="setOptimalPrice()"
                ><i class="fas fa-magic"></i>378‚ÇΩ</span
              >
            </h4>

            <div class="price-slider-container">
              <div class="price-scale" id="price-scale">
                <div class="price-pointer" id="price-pointer">
                  <span class="price-label-float" id="pointer-float-label">
                    378‚ÇΩ (42.72% P)
                  </span>
                </div>
              </div>
              <div class="price-labels">
                <span id="label-min-price">180‚ÇΩ (–ú–∏–Ω)</span>
                <span id="label-avg-price">315‚ÇΩ</span>
                <span id="label-max-price">450‚ÇΩ (–ú–∞–∫—Å)</span>
              </div>
            </div>

            <div class="bid-controls">
              <div class="price-input-group">
                <button class="price-spinner-button" onclick="changePrice(-5)">-</button>
                <input
                  type="number"
                  id="price-bid"
                  class="price-input"
                  value="378"
                  pattern="[0-9]*"
                  inputmode="numeric"
                  readonly
                />
                <button class="price-spinner-button" onclick="changePrice(5)">+</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∞–¥—Ä–µ—Å–∞ "–û–¢–ö–£–î–ê" (–≥–¥–µ –∫–ª–∏–µ–Ω—Ç) -->
    <div id="from-location-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>–û—Ç–∫—É–¥–∞ –∑–∞–±–∏—Ä–∞–µ–º –∫–ª–∏–µ–Ω—Ç–∞</h3>
          <span class="close-button" onclick="closeFromLocationModal()">&times;</span>
        </div>
        <div class="modal-body">
          <p id="from-location-full-text">–£–ª–∏—Ü–∞ –í–æ—Ä–æ–Ω–µ—á–∞ –í.–ò., 30+5</p>
          <p class="location-description">–¢–æ—á–∫–∞ –ø–æ—Å–∞–¥–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞</p>
        </div>
      </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∞–¥—Ä–µ—Å–∞ "–ö–£–î–ê" (–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ) -->
    <div id="to-location-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>–ö—É–¥–∞ –≤–µ–∑—ë–º –∫–ª–∏–µ–Ω—Ç–∞</h3>
          <span class="close-button" onclick="closeToLocationModal()">&times;</span>
        </div>
        <div class="modal-body">
          <p id="to-location-full-text">—É–ª. –Ø—Ö–æ–Ω—Ç–æ–≤–∞—è, 1</p>
          <p class="location-description">–¢–æ—á–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è</p>
        </div>
      </div>
    </div>

    <div id="analysis-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <span class="close-button" onclick="closeModal()">&times;</span>
        </div>

        <h2>–î–µ—Ç–∞–ª—å–Ω—ã–π –ê–Ω–∞–ª–∏–∑ PricePilot</h2>

        <div class="metrics-grid">
          <div class="metric-card">
            <h4>–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –¶–µ–Ω–∞ (EV)</h4>
            <p id="optimal-price-value" class="zone-yellow">378.36 ‚ÇΩ</p>
            <span id="optimal-price-expected-value">–û–∂–∏–¥–∞–µ–º–∞—è –í—ã–≥–æ–¥–∞: 161.64 ‚ÇΩ</span>
          </div>

          <div class="metric-card">
            <h4>–ü—Ä–æ–≥–Ω–æ–∑ P(is_done)</h4>
            <p id="optimal-price-prob">42.72%</p>
            <span id="optimal-price-zone-score"
              ><strong class="zone-yellow">YELLOW</strong> | Score: 3</span
            >
          </div>

          <div class="metric-card">
            <h4>–¶–µ–Ω–∞ –ú–∞–∫—Å. –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏</h4>
            <p id="max-prob-price-value" class="zone-green">54.0 ‚ÇΩ</p>
            <span>–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: <strong id="max-prob">56.15%</strong></span>
          </div>

          <div class="metric-card">
            <h4>–¢–µ–∫—É—â–∞—è –°—Ç–∞–≤–∫–∞</h4>
            <p id="current-bid-value">378 ‚ÇΩ</p>
            <span id="current-bid-expected-value">–û–∂–∏–¥. –í—ã–≥–æ–¥–∞: 161.64 ‚ÇΩ</span>
          </div>
        </div>

        <h3>üí∞ –≠–∫–æ–Ω–æ–º–∏–∫–∞ –¢–æ–ø–ª–∏–≤–∞</h3>
        <div class="fuel-economics-panel">
          <div class="fuel-metric">
            <i class="fas fa-gas-pump"></i>
            <div class="fuel-metric-content">
              <span class="fuel-metric-label">–†–∞—Å—Ö–æ–¥ —Ç–æ–ø–ª–∏–≤–∞</span>
              <span class="fuel-metric-value" id="fuel-cost-value">59.40 ‚ÇΩ</span>
              <span class="fuel-metric-detail" id="fuel-liters-detail">1.08 –ª</span>
            </div>
          </div>
          <div class="fuel-metric">
            <i class="fas fa-chart-line"></i>
            <div class="fuel-metric-content">
              <span class="fuel-metric-label">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞</span>
              <span class="fuel-metric-value" id="min-profitable-value">77.22 ‚ÇΩ</span>
              <span class="fuel-metric-detail">–¢–æ–ø–ª–∏–≤–æ + 30%</span>
            </div>
          </div>
          <div class="fuel-metric">
            <i class="fas fa-wallet"></i>
            <div class="fuel-metric-content">
              <span class="fuel-metric-label">–ß–∏—Å—Ç–∞—è –≤—ã–≥–æ–¥–∞</span>
              <span class="fuel-metric-value zone-green" id="net-profit-value">210.71 ‚ÇΩ</span>
              <span class="fuel-metric-detail" id="net-profit-detail">–ü–æ—Å–ª–µ —Ç–æ–ø–ª–∏–≤–∞</span>
            </div>
          </div>
        </div>

        <h3>–ó–æ–Ω–æ–≤—ã–µ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3>
        <div class="analysis-table-container">
          <table class="analysis-table">
            <thead>
              <tr>
                <th>–ó–æ–Ω–∞/ID</th>
                <th>–î–∏–∞–ø–∞–∑–æ–Ω –¶–µ–Ω (‚ÇΩ)</th>
                <th>P(is_done) Avg</th>
                <th>–í—ã–≥–æ–¥–∞ (‚ÇΩ) Avg</th>
                <th>–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è</th>
              </tr>
            </thead>
            <tbody id="recommendations-body"></tbody>
          </table>
        </div>

        <h4 style="margin-top: 20px">–ü–æ—á–µ–º—É –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –ª—É—á—à–µ?</h4>
        <p style="font-size: 13px; line-height: 1.5; padding: 0 5px; opacity: 0.8" id="normalization-description">
          –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ –º–∞–∫—Å–∏–º–∏–∑–∏—Ä—É–µ—Ç <strong>–æ–∂–∏–¥–∞–µ–º—É—é –≤—ã–≥–æ–¥—É</strong> = —Ü–µ–Ω–∞ √ó –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø—Ä–∏–Ω—è—Ç–∏—è. 
          –ù–∞–ø—Ä–∏–º–µ—Ä: —Ü–µ–Ω–∞ 435‚ÇΩ —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é 73% –¥–∞—ë—Ç –≤—ã–≥–æ–¥—É 317‚ÇΩ, –∞ —Ü–µ–Ω–∞ 720‚ÇΩ —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é 17% ‚Äî —Ç–æ–ª—å–∫–æ 122‚ÇΩ.
          <br><br>
          <strong>–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å</strong> –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –Ω–∞—Å–∫–æ–ª—å–∫–æ –±–ª–∏–∑–∫–∞ –∑–æ–Ω–∞ –∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ—Å—Ç–∏–∂–∏–º–æ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–∫–∞–∑–∞.
        </p>
      </div>
    </div>

    <!--__WEBUI_CONFIG__-->
    <script src="/assets/js/app.js" type="module"></script>
  </body>
</html>
